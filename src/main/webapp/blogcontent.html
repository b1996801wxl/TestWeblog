<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html" charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="css/blogcontent.css">
    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="layui/css/layui.css">
    <script type="text/javascript" src="layui/layui.all.js"></script>
    <script>
        $(function () {
            function load() {
                $.ajax({
                    url: "/ShowContentServlet",
                    type: "post",
                    dataType: "json",
                    success: function (result) {
                        var re = result;
                        for (var i = 0; i < result.length; i++) {

                            var new_main = old_main.clone(true);
                            new_main.attr("blogid",result[i].blog_id);
                            new_main.attr("userid",result[i].USER_ID);
                            new_main.attr("userna",result[i].USER_NAME);
                            $("body").append(new_main);
                            var bid1 = result[i].blog_id;
                            $(".blogcontent_shoucang").hide();
                            if (re[i].BLOG_IMG == "") {
                                new_main.children().eq(0).children().attr("src", result[i].HEAD_IMG);
                                new_main.children().eq(2).children().eq(0).children().text(result[i].USER_NAME);
                                new_main.children().eq(2).children().eq(1).children().text(result[i].BLOG_TEXT);
                            } else {
                                var img = JSON.parse(re[i].BLOG_IMG);
                                new_main.children().eq(0).children().attr("src", result[i].HEAD_IMG);
                                new_main.children().eq(2).children().eq(0).children().text(result[i].USER_NAME);
                                new_main.children().eq(2).children().eq(1).children().text(result[i].BLOG_TEXT);
                                $.ajax({
                                    url: "/ShowDiscussServlet",
                                    type: "post",
                                    data: {"blog_id": bid1},
                                    dataType: "json",
                                    success: function (result) {
                                        alert(result);
                                        var num = result;
                                        new_main.children().eq(2).children().eq(3).children().children().eq(3).children().children(1).test(num);
                                    }
                                })
                                for (var j = 0; j < img.length; j++) {
                                    var $node = ('<img src="' + img[j] + '" alt="" width="110px" height="110px" style="margin: 2px">')
                                    new_main.children().eq(2).children().eq(2).append($node);
                                }
                            }
                        }
                    }
                })
            }

            //--------------收藏
            $(".blogcontent_button_a").eq(0).click(function (e) {
                e.preventDefault();
                if ($($(this.parentNode.parentNode.parentNode.parentNode).next()).is(':hidden')) {
                    $($(this.parentNode.parentNode.parentNode.parentNode).next()).show();
                } else {
                    $($(this.parentNode.parentNode.parentNode.parentNode).next()).hide();
                }
            })
            //-------------------转发
            $(".blogcontent_button_a").eq(1).click(function (e) {
                e.preventDefault();

            })
            //-----------------------评论
            $(".blogcontent_button_a").eq(2).click(function (e) {
                e.preventDefault();
                if ($($(this.parentNode.parentNode.parentNode.parentNode).next().next()).is(':hidden')) {
                    $($(this.parentNode.parentNode.parentNode.parentNode).next().next()).show();
                } else {
                    $($(this.parentNode.parentNode.parentNode.parentNode).next().next()).hide();
                }
            })
            $("#tijiaopinglun-btn").click(function () {
                var bid = $(this).closest($(".blogcontent_main")).attr("blogid");
                var uid = $(this).closest($(".blogcontent_main")).attr("userid");
                $.ajax({
                    url: '/InsertDiscussServlet',
                    type: 'post',
                    data: {"discussId": "56", "blogId": bid, "userId": uid, "discussText": "henghengasdfa"},
                    dataType: 'json',
                    success: function () {
                        var node = ('<span>'+result[i].DISCUSS_TEXT+'</span>');
                        ($(this).closest($(".blogcontent_main"))).find(".append").append();

                    }
                });
            })


            //-----------------------点赞
            $(".blogcontent_button_a").eq(3).click(function (e) {
                e.preventDefault();
                var str = $(this).find('img').attr("src");
                if (str == "images/nolike.png") {
                    $(this).find('img').attr('src', 'images/like.png');
                } else {
                    $(this).find('img').attr('src', 'images/nolike.png');
                }
            })
            var old_main = $(".blogcontent_main").detach();
            load();
        })
    </script>
</head>
<body style="background: #999999">

<div class="blogcontent_main">
    <div class="blogcontent_head">
        <img src="" alt="">
    </div>
    <div class="blogcontent_sanjiao"></div>
    <div class="blogcontent_body">
        <div class="blogcontent_username"><a href=""></a></div>
        <div class="blogcontent_word"><p></p></div>
        <div class="blogcontent_photo">

            <input type="hidden" value="" name="blog_id" id="blog_id">
        </div>
        <div class="blogcontent_bottom">
            <div class="blogcontent_button">
                <span class="blogcontent_button_span"><a href="" class="blogcontent_button_a">收藏(3)</a></span>
                <span class="blogcontent_button_span"><a href="" class="blogcontent_button_a">转发(6)</a></span>
                <span class="blogcontent_button_span"><a href="" class="blogcontent_button_a">评论(1)</a></span>
                <span class="blogcontent_button_span"><a href="" class="blogcontent_button_a"><img
                        src="images/nolike.png" alt=""><span class="blogcontent_button_zan_num"></span></a></span>
            </div>
        </div>
    </div>
    <div class="blogcontent_shoucang">//
        <ul>
            <li>
                <div class="blogcontent_shoucang_demo"></div>
            </li>
            <li>
                <div class="blogcontent_shoucang_demo"></div>
            </li>
        </ul>
    </div>
    <div class="blogcontent_pinglun">
        <div class="blogcontent_pinglun_text">
            <div><span>评论</span></div>
            <div><textarea name="" id="" cols="30" rows="10"></textarea></div>
            <div><input type="submit" class="tijiaopinglun-btn" id="tijiaopinglun-btn"></div>
        </div>
        <ul>
            <li>
                <div class="blogcontent_pinglun_demo">666</div>
            </li>
        </ul>
    </div>
    <div class="blogcontent_util"></div>
</div>

</body>
</html>